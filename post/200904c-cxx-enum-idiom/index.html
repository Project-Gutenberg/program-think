<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="../../post/index.xml">
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@SpeechFreedomCN">
    <meta name="twitter:creator" content="@SpeechFreedomCN">
    <meta name="og:title" content=" C/C&#43;&#43; 中一个简单的 enum 手法&amp;#65288;idiom&amp;#65289; | 编程随想镜像站 " />
    <meta name="og:description" content="今天写程序的时候，又用到这个 idiom 了，于是顺便贴出来。这个 idiom 蛮简单的，估计很多人都用过。今天主要是贴出来给新手参考（老手们就甭费时看此帖了）。 为了说明这个手法具体该咋用，咱举一个简单的例子来说事儿。比方说要开发一个网络程序，其中需要统计各种网络协议的数据包数量。 假设一开始只需要处理 HTTP 和 FTP 两种协议。有些同学不假思索，立即会声明如下两个整数用于统计：
int nCntHttp \= 0; int nCntFtp \= 0;
　猛一看，似乎没啥问题。但是，如果需求发生变更，又要增加两种协议：SMTP 和 SSH。然后，该同学会继续扩展上述代码，变为如下：
int nCntHttp \= 0; int nCntFtp \= 0; int nCntSmtp \= 0; int nCntSsh \= 0;
　这时候，问题开始显露出来了。比方说要打印上述4统计值，就得写4个 printf 语句；再假如要用断言确保所有统计值大于零，也得写4个 assert 断言。这都是挺烦人的事儿。（当然啦，有些同学会把4个变量的打印写在一个 printf 中，但还是一样烦人） 这可咋办捏？有点小聪明的程序猿就灵机一动，把上述代码修改为数组形式，上述的4个统计值【依次】放入数组中。具体如下：
int nCntProto[4]; /* 第0个是HTTP，第1个是FTP，第2个是SMTP，第3个是SSH */" />
    <meta name="og:image"
        content="https://opvlbqxurl.execute-api.ap-northeast-2.amazonaws.com/prod/random?keyword=programming&slug=C/C&#43;&#43; 中一个简单的 enum 手法&amp;#65288;idiom&amp;#65289;" />
    <title> C/C&#43;&#43; 中一个简单的 enum 手法&amp;#65288;idiom&amp;#65289; | 编程随想镜像站</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-151212685-4', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-151212685-4', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css" />
    <link rel="stylesheet" href="https://project-gutenberg.github.io/program-think/css/blog.css" />
    
    <!-- plugins -->
    
    <link rel="stylesheet" href="https://project-gutenberg.github.io/program-think/plugins/bootstrap/bootstrap.min.css ">
    
    <link rel="stylesheet" href="https://project-gutenberg.github.io/program-think/plugins/themify-icons/themify-icons.css ">
    

</head>

<body>

    
    <nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="https://project-gutenberg.github.io/program-think/">Home</a>
        </div>
        <div class="navbar-brand">
            <a class="navbar-item" href="https://project-gutenberg.github.io/program-think/post/index.xml">RSS</a>
        </div>
    </nav>
    

    
    <section class="hero is-info is-medium">
        <div class="hero-body" style="background-image: url(https://project-gutenberg.github.io/program-think/img/bg-blog.jpg);">
            <div class="container has-text-centered">
                <br>
                <h1 class="title is-size-1">
                    
                    C/C&#43;&#43; 中一个简单的 enum 手法&amp;#65288;idiom&amp;#65289;
                    
                </h1>
                
            </div>
        </div>
    </section>

<div class="container">
    <div class="section">
    

<div class="columns">
    <div class="column is-12">
        <div class="tile is-child box">
            

            <div class="content">
                <p>　　今天写程序的时候，又用到这个 idiom 了，于是顺便贴出来。这个 idiom 蛮简单的，估计很多人都用过。今天主要是贴出来给新手参考（老手们就甭费时看此帖了）。 　　为了说明这个手法具体该咋用，咱举一个简单的例子来说事儿。比方说要开发一个网络程序，其中需要统计各种网络协议的数据包数量。 　　假设一开始只需要处理 HTTP 和 FTP 两种协议。有些同学不假思索，立即会声明如下两个整数用于统计：</p>

<p>int nCntHttp \= 0;
int nCntFtp \= 0;</p>

<p>　　猛一看，似乎没啥问题。但是，如果需求发生变更，又要增加两种协议：SMTP 和 SSH。然后，该同学会继续扩展上述代码，变为如下：</p>

<p>int nCntHttp \= 0;
int nCntFtp \= 0;
int nCntSmtp \= 0;
int nCntSsh \= 0;</p>

<p>　　这时候，问题开始显露出来了。比方说要打印上述4统计值，就得写4个 printf 语句；再假如要用断言确保所有统计值大于零，也得写4个 assert 断言。这都是挺烦人的事儿。（当然啦，有些同学会把4个变量的打印写在一个 printf 中，但还是一样烦人） 　　这可咋办捏？有点小聪明的程序猿就灵机一动，把上述代码修改为数组形式，上述的4个统计值【依次】放入数组中。具体如下：</p>

<p>int nCntProto[4];
/* 第0个是HTTP，第1个是FTP，第2个是SMTP，第3个是SSH */</p>

<p>　　这样一来，无论是打印还是断言，用一个 for 循环就搞定，貌似挺方便滴。 　　但这么一来，引入了另一个问题：假设我在程序中要用到 SMTP 的统计数字，就得这么写代码：<br />
　　这就造成了很不雅观的“<a href="https://en.wikipedia.org/wiki/Magic_number_(programming)#Unnamed_numerical_constant">Magic Number</a>”！要知道，Magic Number 可是代码的臭味之一啊（其弊端在“<a href="https://program-think.blogspot.com/2009/02/defect-of-java-beginner-3-code-style.html#magic_number">这篇博文</a>”中曾经介绍过）。万一将来，数组中的存放顺序发生变化，那就完蛋了：好多用到 Magic Number 的代码都得跟着改。一旦漏改某处，引出 Bug 无数！ 　　为了消除 Magic Number，增加代码可读性和可维护性，有些同学开始打起 enum 的主意。在代码中增加了一组 enum，具体如下：</p>

<p>enum PROTO
{ PROTO_HTTP, PROTO_FTP, PROTO_SMTP, PROTO_SSH,
}; int nCntProto[4];</p>

<p>　　这样，如果我需要用到 SMTP 的统计数字，我就不用写而是写<br />
　　显然，可读性明显好多了。即使将来数组中的存放顺序发生变化，也没关系：只需稍微调整 enum 中常量的顺序即可，其它代码不用动。 　　但是，还是有一个不爽的地方。定义数组的语句用到了“4”这个 Magic Number。万一将来需求继续变更，继续增加协议，那这个数字还得不断调整。还是有点不爽！ 　　咋办捏？这时候，终极版本隆重登场。请看如下代码：</p>

<p>enum PROTO
{ PROTO_HTTP, PROTO_FTP, PROTO_SMTP, PROTO_SSH, PROTO_NUM /* 表示协议数量 */
}; int nCntProto[PROTO_NUM];</p>

<p>　　这种写法的好处在于，【没有任何一个】Magic Number 出现在代码中。不管是引用某个统计值还是循环遍历数组，都使用的是定义好的常量。 　　就算未来发生需求变更，要增加新的协议，只要往 enum 中增加相应的 enum 常量即可（但要记得保证 PROTO_NUM 位于 enum 定义的末尾）。由于 PROTO_NUM 会自动跟着增长，所以其它的代码几乎不会受到影响。 　　上述代码同时适用于 C 和 C++。不过捏，某些 C++ 程序员或许看不惯原始数组，觉得 STL 的容器类看起来比较顺眼。那也没啥大关系：只要把上述代码中声明数组的那句修改为如下，其它的代码基本照旧。</p>

<p>std::vector<int\> vctCntProto(PROTO_NUM);</p>

            </div>
            
        </div>
    </div>
</div>


    </div>
</div>

<footer class="footer has-background-grey-darker has-text-white">
    <div class="content has-text-centered">
        <p>
            <br><br>
            <span>友链：<a href="https://program-think.blogspot.com/">编程随想的博客</a>
            <span>友链：<a href="http://www.xys.org/">新语丝</a>
                <span> </span><a href="https://twitter.com/fangshimin">方舟子 Twitter</a>
            </span>
            <br><br>
            Copyright &copy; 编程随想镜像站 2021
        </p>
    </div>
</footer>

<script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js"></script>
</body>

</html>